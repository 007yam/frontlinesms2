#!/bin/bash
set -e

echo "#############################################"
echo "## This script aims to test new installers ##"
echo "## 1. Build installer                      ##"
echo "## 2. uninstall old installation           ##"
echo "## 3. install new version                  ##"
echo "## 4. run new version                      ##"
echo "## 5. check that the server is working!    ##"
echo "#############################################"

PROJECT_DIR=../frontlinesms-core
INSTALL_DIR=~/frontlinesms2
ALL_USER_INSTALL_DIR=/opt/frontlinesms2
SETTINGS_DIR=~/.frontlinesms2
SERVER_PORT=8130
CONTEXT_PATH=

echo "# clean target directories"
rm -rf $PROJECT_DIR/target/
rm -rf target/
rm -rf $PROJECT_DIR/install/target*
rm -rf $PROJECT_DIR/install/src/web-app/

echo "# build-installers"
grails clean
grails -Dfrontlinesms2.build.confirmNotProd=true build-installers $@

do/uninstall_install_test

